<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard - smartAttendX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- üé® CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        height: 100vh;
      }
      /* Sidebar */
      .sidebar {
        width: 250px;
        background: #2c3e50;
        color: #fff;
        display: flex;
        flex-direction: column;
        padding: 1rem;
      }
      .profile {
        text-align: center;
        margin-bottom: 2rem;
      }
      .profile img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-bottom: 0.5rem;
        object-fit: cover;
      }
      .sidebar a {
        display: block;
        padding: 0.8rem;
        margin: 0.3rem 0;
        text-decoration: none;
        color: #fff;
        background: #34495e;
        border-radius: 5px;
        transition: background 0.3s;
      }
      .sidebar a:hover {
        background: #1abc9c;
      }
      /* Main content */
      .content {
        flex-grow: 1;
        padding: 2rem;
        overflow-y: auto;
      }
      .hidden {
        display: none;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      /* Table */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }
      table,
      th,
      td {
        border: 1px solid #ddd;
      }
      th,
      td {
        padding: 0.8rem;
        text-align: left;
      }
      th {
        background: #007bff;
        color: white;
      }
      /* Dark Theme */
      body.dark {
        background: #1e1e1e;
        color: #f4f4f4;
      }
      body.dark .sidebar {
        background: #111;
      }
      body.dark .sidebar a {
        background: #222;
      }
      body.dark th {
        background: #444;
      }

      /* Topbar */
      .topbar-profile {
        position: absolute;
        top: 15px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .topbar-pic {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #fff;
      }
    </style>

    <!-- üì¶ Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Topbar -->
    <div class="topbar-profile">
      <img
        src="{{ url_for('static', filename=admin['profile_pic']) if admin['profile_pic'] else url_for('static', filename='image.png') }}"
        alt="Profile Picture"
        class="topbar-pic"
      />
      <span class="topbar-name">
        <a
          href="{{ url_for('profile') }}"
          style="color: inherit; text-decoration: none"
        >
          {{ admin['name'] }}
        </a>
      </span>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <a href="#" onclick="showSection('startAttendance')"
        >üìã Start Attendance</a
      >
      <a href="#" onclick="showSection('viewAttendance')">üëÅ View Attendance</a>
      <a href="#" onclick="showSection('registerStudent')"
        >‚ûï Register Student</a
      >
      <a href="#" onclick="showSection('notify')">üì¢ Notify</a>
      <a href="#" onclick="toggleTheme()">üåô Toggle Theme</a>
      <a href="#" onclick="showSection('settings')">‚öô Settings</a>
      <a href="{{ url_for('logout') }}">üö™ Logout</a>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- Start Attendance -->
      <section id="startAttendance" class="">
        <h2>Start Attendance</h2>
        <form action="/start-attendance" method="POST">
          <button type="submit">‚ñ∂ Run Face Recognizer</button>
        </form>
        <p>Attendance recognizer will open and mark students automatically.</p>
      </section>

      <!-- View Attendance -->
      <section id="viewAttendance" class="hidden">
        <h2>View Attendance</h2>
        <canvas id="attendanceChart" width="400" height="200"></canvas>
        <h3>Student List</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Roll No</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr>
              <td>{{ student.id }}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.roll_no }}</td>
              <td>
                <a
                  href="{{ url_for('attendance_history', student_id=student.id) }}"
                  >üìÖ View History</a
                >
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="4">No students found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <!-- Register Student -->
      <section id="registerStudent" class="hidden">
        <h2>Register New Student</h2>
        <form action="/register-student" method="POST">
          <input
            type="text"
            name="student_id"
            placeholder="Student ID"
            required
          /><br /><br />
          <input
            type="text"
            name="name"
            placeholder="Full Name"
            required
          /><br /><br />
          <input
            type="email"
            name="email"
            placeholder="Student Email"
            required
          /><br /><br />
          <input
            type="text"
            name="roll_no"
            placeholder="Roll No"
            required
          /><br /><br />
          <input
            type="text"
            name="guardian_no"
            placeholder="Guardian Contact No"
            required
          /><br /><br />
          <input
            type="email"
            name="guardian_email"
            placeholder="Guardian Email"
            required
          /><br /><br />
          <button type="submit">Register Student</button>
        </form>
      </section>

      <!-- Notify -->
      <section id="notify" class="hidden">
        <h2>Send Notifications</h2>

        <p>
          ‚úÖ Present: <strong>{{ present_count }}</strong> | ‚ùå Absent:
          <strong>{{ absent_count }}</strong>
        </p>

        <form action="/notify" method="POST">
          <label>Send To:</label>
          <select name="target" required>
            <option value="all">
              All Students ({{ present_count + absent_count }})
            </option>
            <option value="present">
              Present Students ({{ present_count }})
            </option>
            <option value="absent">
              Absent Students ({{ absent_count }})
            </option></select
          ><br /><br />

          <textarea
            name="message"
            placeholder="Write your message..."
            required
          ></textarea
          ><br /><br />

          <button type="submit">üì¢ Send Notification</button>
        </form>
      </section>

      <!-- Settings -->
      <section id="settings" class="hidden">
        <h2>Settings</h2>
        <p>Feature coming soon (change password, update profile, etc.).</p>
      </section>
    </div>

    <!-- JS -->
    <script>
      function showSection(sectionId) {
        document.querySelectorAll(".content section").forEach(sec => {
          sec.classList.add("hidden");
        });
        document.getElementById(sectionId).classList.remove("hidden");
      }

      function toggleTheme() {
        document.body.classList.toggle("dark");
      }

      // Attendance Chart
      const ctx = document.getElementById("attendanceChart");
      if (ctx) {
        new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Present", "Absent"],
            datasets: [{
              data: [{{ present_count|default(0) }}, {{ absent_count|default(0) }}],
              backgroundColor: ["#28a745", "#dc3545"]
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { position: "bottom" } }
          }
        });
      }
    </script>
  </body>
</html>
